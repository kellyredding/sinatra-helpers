require 'logger'
LOGGER = Logger.new(root_path('log', "#{RACK_ENV}.log"))
 
require 'config/gems'
Gemsconfig::load if defined?(Gemsconfig)

# basic app configurations
set :root, root_path
set :views, root_path("app", "views")
set :images_path, public_path("images")
set :environment, RACK_ENV.to_sym if defined?(RACK_ENV)

# Load environment
begin
  require "config/envs/#{RACK_ENV.downcase}"
rescue LoadError => err
  puts "no environment config set up for '#{RACK_ENV.downcase}', ignoring..."
end

# load app files
load_app 'helpers'
load_app 'models'

# Load initializers
Dir[root_path('config', 'initializers', '*.rb')].each do |file|
  require file
end

# load middlewares
# TODO: set your session cookie name here
use Rack::Session::Cookie, :key => '_sess'
use Rack::Flash

use Rack::Less
Rack::Less.configure do |config|
  config.combinations = {
    'web' => ['reset', 'app']
  }
  config.combination_timestamp = if !development?
    File.mtime(Sinatra::Application.root).to_i
  else
    true
  end
  if config.cache = !development?
    config.compress = :whitespace
  end
end

use Rack::Sprockets
Rack::Sprockets.configure do |config|
  config.cache = production? 
end
